pipeline {
    agent any
    stages {    
         stage('Compile') {
            steps {
                script {
                    dir('DevOps_Project')
                    {sh 'mvn compile'}
                }
            }
        }
        
          stage('Build') {
              steps {
                 script {
                    dir('DevOps_Project')
                    {sh 'mvn package '}
                }
            }
        }
          
     stage('SONARQUBE') {
            steps {
                script {
                    dir('DevOps_Project')
                    {sh 'mvn sonar:sonar -Dsonar.login=squ_036b7cd4a30da2a71a44697198f2f661863e1458'}
                }
            }
        }
        stage('Nexus'){
              steps {
                 script {
                    dir('DevOps_Project')
                    {sh 'mvn deploy -Dmaven.test.skip=true '}
                }
            } 
        }

       post {
        success {
            emailext (
                subject: 'Construction réussie',
                body: 'La construction du projet a réussi. Tout est en ordre!',
                to: 'fatma.trabelsi@esprit.tn'
            )
        }
        failure {
            emailext (
                subject: 'Construction échouée',
                body: 'La construction du projet a échoué. Veuillez vérifier les logs.',
                to: 'fatma.trabelsi@esprit.tn'
            )
        }
 

     
}
}
